angular.module("demoApp",["weeklyScheduler"]).controller("DemoController",["$scope","$timeout","$log",function(e,t,l){e.model={options:{editSlot:function(){alert("Editing slot")}},items:[{label:"Sun",schedules:[{start:315,end:375}]},{label:"Mon",schedules:[{start:300,end:1140}]},{label:"Tue",schedules:[{start:0,end:240},{start:300,end:360}]},{label:"Wed",schedules:[{start:120,end:720}]},{label:"Thur",editable:!1,schedules:[{start:300,end:1140}]},{label:"Fri",schedules:[{start:720,end:780}]},{label:"Sat",schedules:[]}]},this.doSomething=function(e,t,l){console.log("The model has changed!",e,t,l)}}]),angular.module("weeklyScheduler",["ngWeeklySchedulerTemplates"]);var HandleDirective=function(){function e(e){var t=this;this.$document=e,this.restrict="A",this.scope={ondrag:"&",ondragstop:"&",ondragstart:"&"},this.link=function(e,l){var r=t.$document,n=0;function i(t){var l=t.pageX-n;angular.isFunction(e.ondrag)&&e.ondrag({delta:l})}function o(){r.unbind("mousemove",i),r.unbind("mouseup",o),angular.isFunction(e.ondragstop)&&e.ondragstop()}l.on("mousedown",function(t){t.preventDefault(),n=t.pageX,r.on("mousemove",i),r.on("mouseup",o),angular.isFunction(e.ondragstart)&&e.ondragstart()})}}return e.Factory=function(){var t=function(t){return new e(t)};return t.$inject=["$document"],t},e.$name="handle",e}();angular.module("weeklyScheduler").directive(HandleDirective.$name,HandleDirective.Factory());var HourlyGridDirective=function(){function e(){var e=this;this.restrict="E",this.require="^weeklyScheduler",this.GRID_TEMPLATE=angular.element('<div class="grid-item"></div>'),this.link=function(t,l,r,n){n.config&&e.doGrid(t,l,r,n.config)}}return e.prototype.handleClickEvent=function(e,t,l,r){e.bind("click",function(){r.$emit("clickOnACell",{nbElements:t,idx:l})})},e.prototype.doGrid=function(e,t,l,r){var n=r.hourCount,i=this.GRID_TEMPLATE.clone();t.empty();for(var o=0;o<n;o++){var s=i.clone();if(angular.isUndefined(l.noText)){this.handleClickEvent(s,n,o,e);var a=o%12,d=o>=12?"p":"a";s.text(""+(a||"12")+d)}else{s.addClass("striped");for(var c=60/r.interval,u=100/c,h=0;h<c;h++){var m=this.GRID_TEMPLATE.clone();m.attr("rel",(o*c+h)*r.interval),m.addClass("interval"),m.css("width",u+"%"),s.append(m)}}t.append(s)}},e.Factory=function(){return function(){return new e}},e.$name="hourlyGrid",e}();angular.module("weeklyScheduler").directive(HourlyGridDirective.$name,HourlyGridDirective.Factory());var MultiSliderController=function(){function e(e,t,l){this.$element=e,this.$scope=t,this.$window=l,this.canAdd=!0,this.isDragging=!1,this.isHoveringSlot=!1,this.size=60,this.element=this.$element[0]}return e.prototype.$onInit=function(){var e=this;this.$scope.$on("resized",function(){e.resize()}),this.$scope.$on("zoomedIn",function(){e.resize()}),this.$scope.$on("zoomedOut",function(){e.resize()})},e.prototype.$postLink=function(){var e=this;this.$hoverElement=angular.element(this.$element.find("div")[0]),this.$element.on("mousemove",function(t){var l=e.getElementOffsetX(e.$element),r=t.pageX-l-e.$hoverElement[0].clientWidth/2,n=e.pixelToVal(r);e.$hoverElement.css({left:e.getSlotLeft(n),right:e.getSlotRight(n+e.size)})})},e.prototype.addSlot=function(e,t){e<0&&(e=0),t>this.config.maxValue&&(t=this.config.maxValue);var l=this.item;l.schedules||(l.schedules=[]),l.schedules.push({start:e,end:t}),this.schedulerCtrl.onAdd()},e.prototype.getElementOffsetX=function(e){return e[0].getBoundingClientRect().left},e.prototype.compensateForBorder=function(e,t){var l=this.$window.getComputedStyle(e).getPropertyValue("border-right");return t%60==0?e.offsetLeft:e.offsetLeft-parseInt(l,10)},e.prototype.getSlotLeft=function(e){var t=this.getUnderlyingInterval(e);return this.compensateForBorder(t,e)+"px"},e.prototype.getSlotRight=function(e){var t=this.getUnderlyingInterval(e-this.config.interval),l=this.compensateForBorder(t,e)+t.offsetWidth,r=this.getElementOffsetX(this.$element);return this.$element[0].getBoundingClientRect().right-r-l+"px"},e.prototype.getUnderlyingInterval=function(e){e<0&&(e=0);var t=this.config.maxValue-this.config.interval;return e>t&&(e=t),this.$element.parent()[0].querySelector("[rel='"+e+"']")},e.prototype.onHoverElementClick=function(e){if(this.canAdd){var t=this.getElementOffsetX(this.$element),l=this.getElementOffsetX(this.$hoverElement)-t,r=this.pixelToVal(l),n=r+this.size;this.addSlot(r,n)}},e.prototype.onWeeklySlotMouseOver=function(){this.isHoveringSlot=!0},e.prototype.onWeeklySlotMouseLeave=function(){this.isHoveringSlot=!1},e.prototype.resize=function(){this.$scope.$apply()},e.prototype.pixelToVal=function(e){var t=e/this.element.clientWidth;return Math.floor(t*this.config.intervalCount+.5)*this.config.interval},e.$name="multiSliderController",e.$controllerAs="multiSliderCtrl",e.$inject=["$element","$scope","$window"],e}(),MultiSliderComponent=function(){function e(){this.bindings={config:"<",item:"=",index:"<",size:"<?"},this.controller=MultiSliderController.$name,this.controllerAs=MultiSliderController.$controllerAs,this.require={schedulerCtrl:"^weeklyScheduler"},this.templateUrl="ng-weekly-scheduler/multislider/multislider.html"}return e.$name="multiSlider",e}();angular.module("weeklyScheduler").controller(MultiSliderController.$name,MultiSliderController).component(MultiSliderComponent.$name,new MultiSliderComponent);var ResizeService=function(){function e(e,t){this.$rootScope=e,this.$window=t,this.initialized=!1}return e.prototype.initialize=function(){var e=this;this.initialized||(this.$window.addEventListener("resize",function(){e.$rootScope.$broadcast("resized")}),this.initialized=!0)},e.$name="resizeService",e.$inject=["$rootScope","$window"],e}();angular.module("weeklyScheduler").service(ResizeService.$name,ResizeService).run([ResizeService.$name,function(e){return e.initialize()}]);var ScheduleAreaContainerController=function(){function e(e,t,l,r){this.$element=e,this.$scope=t,this.scrollService=l,this.zoomService=r}return e.prototype.$postLink=function(){var e=this,t=this.$element[0];this.scrollService.hijackScroll(t,20),this.$scope.$on("clickOnACell",function(l,r){e.zoomService.zoomInACell(t,l,r)})},e.$name="scheduleAreaContainerController",e.$inject=["$element","$scope","scrollService","zoomService"],e}(),ScheduleAreaContainerComponent=function(){function e(){this.controller=ScheduleAreaContainerController.$name,this.transclude=!0,this.template="<ng-transclude></ng-transclude>"}return e.$name="scheduleAreaContainer",e}();angular.module("weeklyScheduler").controller(ScheduleAreaContainerController.$name,ScheduleAreaContainerController).component(ScheduleAreaContainerComponent.$name,new ScheduleAreaContainerComponent);var ScrollService=function(){function e(e){this.zoomService=e}return e.prototype.hijackScroll=function(e,t){var l=this;e.addEventListener("mousewheel",function(r){return r.preventDefault(),r.stopPropagation(),r.ctrlKey?l.zoomService.zoomByScroll(e,r,t):(r.wheelDelta||r.detail)>0?e.scrollLeft-=t:e.scrollLeft+=t,!1})},e.$name="scrollService",e.$inject=["zoomService"],e}();angular.module("weeklyScheduler").service(ScrollService.$name,ScrollService);var TimeOfDayFilter=function(){function e(){}return e.Factory=function(){return function(e){var t=Math.floor(e/60),l=(e-60*t).toString(),r=t>11&&t<24?"P":"A";return 1==l.length&&(l="0"+l),(t%12||12)+":"+l+r}},e.$name="timeOfDay",e}();angular.module("weeklyScheduler").filter(TimeOfDayFilter.$name,[TimeOfDayFilter.Factory]);var WeeklySchedulerController=function(){function e(e){this.$scope=e,this.defaultOptions={monoSchedule:!1}}return e.prototype.$onInit=function(){var e=this;this.config=this.configure(this.options),this.$scope.$watchCollection(function(){return e.items},function(t){return e.onModelChange(t)})},e.prototype.configure=function(e){var t=e.interval||15,l=1440/t;return angular.extend(this.defaultOptions,{editSlot:e.editSlot,interval:t,maxValue:1440,hourCount:24,intervalCount:l})},e.prototype.onModelChange=function(e){var t=this;if(e){if(!angular.isArray(e))throw"You should use weekly-scheduler directive with an Array of items";this.items=e,e.forEach(function(e){var l=e.schedules;l&&l.length?t.options.monoSchedule&&(e.schedules=[l[0]]):e.schedules=[]})}},e.$controllerAs="schedulerCtrl",e.$name="weeklySchedulerController",e.$inject=["$scope"],e}(),WeeklySchedulerComponent=function(){function e(){this.bindings={items:"=",options:"=",onAdd:"&",onChange:"&",onDelete:"&"},this.controller=WeeklySchedulerController.$name,this.controllerAs=WeeklySchedulerController.$controllerAs,this.transclude=!0,this.templateUrl="ng-weekly-scheduler/weekly-scheduler/weekly-scheduler.html"}return e.$name="weeklyScheduler",e}();angular.module("weeklyScheduler").controller(WeeklySchedulerController.$name,WeeklySchedulerController).component(WeeklySchedulerComponent.$name,new WeeklySchedulerComponent);var WeeklySlotController=function(){function e(e,t){this.$scope=e,this.$timeout=t,this.resizeDirectionIsStart=!0}return e.prototype.$onInit=function(){this.valuesOnDragStart={start:this.schedule.start,end:this.schedule.end},this.mergeOverlaps()},e.prototype.canEdit=function(){var e=!angular.isDefined(this.item.editable)||this.item.editable,t=angular.isFunction(this.schedulerCtrl.config.editSlot),l=!this.schedule.isActive,r=!this.multisliderCtrl.isDragging;return e&&t&&l&&r},e.prototype.canRemove=function(){return!angular.isDefined(this.item.editable)||this.item.editable},e.prototype.deleteSelf=function(){this.multisliderCtrl.isDragging=!1,this.multisliderCtrl.isHoveringSlot=!1,this.removeSchedule(this.schedule),this.schedulerCtrl.onDelete()},e.prototype.editSelf=function(){this.canEdit()&&this.schedulerCtrl.config.editSlot(this.schedule)},e.prototype.drag=function(e){this.multisliderCtrl.isDragging=!0;var t=this.schedule,l=this.multisliderCtrl.pixelToVal(e),r=this.valuesOnDragStart.end-this.valuesOnDragStart.start,n=Math.round(this.valuesOnDragStart.start+l),i=Math.round(n+r);t.start!==n&&n>=0&&i<=this.config.maxValue&&this.updateSelf({start:n,end:i})},e.prototype.endDrag=function(){var e=this;this.$scope.$apply(function(){e.multisliderCtrl.canAdd=!0,e.schedule.isActive=!1}),this.$timeout(function(){e.multisliderCtrl.isDragging=!1},200),this.mergeOverlaps()},e.prototype.mergeOverlaps=function(){var e=this,t=this.schedule;this.item.schedules.forEach(function(l){l!==t&&(l.end>=t.end&&l.start<=t.start?(e.removeSchedule(l),e.updateSelf({start:l.start,end:l.end})):t.end>=l.end&&t.start<=l.start?e.removeSchedule(l):l.end>=t.start&&l.end<=t.end?(e.removeSchedule(l),e.updateSelf({start:l.start,end:t.end})):l.start>=t.start&&l.start<=t.end&&(e.removeSchedule(l),e.updateSelf({start:t.start,end:l.end})))})},e.prototype.removeSchedule=function(e){var t=this.item.schedules;t.splice(t.indexOf(e),1)},e.prototype.resize=function(e){this.multisliderCtrl.isDragging=!0;var t=this.schedule,l=this.multisliderCtrl.pixelToVal(e);if(this.resizeDirectionIsStart){var r=Math.round(this.valuesOnDragStart.start+l);t.start!==r&&r<=t.end-1&&r>=0&&this.updateSelf({start:r,end:t.end})}else{var n=Math.round(this.valuesOnDragStart.end+l);t.end!==n&&n>=t.start+1&&n<=this.config.maxValue&&this.updateSelf({start:t.start,end:n})}},e.prototype.startDrag=function(){var e=this;this.$scope.$apply(function(){e.schedule.isActive=!0,e.multisliderCtrl.canAdd=!1}),this.valuesOnDragStart={start:this.schedule.start,end:this.schedule.end}},e.prototype.startResizeStart=function(){this.resizeDirectionIsStart=!0,this.startDrag()},e.prototype.startResizeEnd=function(){this.resizeDirectionIsStart=!1,this.startDrag()},e.prototype.updateSelf=function(e){this.schedule.start=e.start,this.schedule.end=e.end,this.ngModelCtrl.$setViewValue(this.schedule),this.onChange()},e.prototype.onChange=function(){this.schedulerCtrl.onChange({itemIndex:this.itemIndex,scheduleIndex:this.scheduleIndex,scheduleValue:this.schedule})},e.$name="weeklySlotController",e.$controllerAs="weeklySlotCtrl",e.$inject=["$scope","$timeout"],e}(),WeeklySlotComponent=function(){function e(){this.bindings={config:"<",schedule:"=ngModel",itemIndex:"<",scheduleIndex:"<",item:"="},this.controller=WeeklySlotController.$name,this.controllerAs=WeeklySlotController.$controllerAs,this.require={multisliderCtrl:"^multiSlider",schedulerCtrl:"^weeklyScheduler",ngModelCtrl:"ngModel"},this.templateUrl="ng-weekly-scheduler/weekly-slot/weekly-slot.html"}return e.$name="weeklySlot",e}();angular.module("weeklyScheduler").controller(WeeklySlotController.$name,WeeklySlotController).component(WeeklySlotComponent.$name,new WeeklySlotComponent);var ZoomService=function(){function e(e){this.$rootScope=e,this.selector=".schedule-area"}return e.prototype.broadcastZoomedInEvent=function(){this.$rootScope.$broadcast("zoomedIn")},e.prototype.broadcastZoomedOutEvent=function(){this.$rootScope.$broadcast("zoomedOut")},e.prototype.getCurrentZoomWidth=function(e){return parseInt(e.querySelector(this.selector).style.width,10)},e.prototype.setZoomWidth=function(e,t){e.querySelector(this.selector).style.width=t},e.prototype.resetZoom=function(e){this.setZoomWidth(e,"100%"),this.broadcastZoomedOutEvent()},e.prototype.zoomInACell=function(e,t,l){var r=l.nbElements,n=l.idx,i=e.offsetWidth,o=i/5,s=2*o,a=r*o/i*100;this.setZoomWidth(e,a+"%"),e.scrollLeft=n*o-s,this.broadcastZoomedInEvent()},e.prototype.zoomByScroll=function(e,t,l){var r=this.getCurrentZoomWidth(e);if((t.wheelDelta||t.detail)>0)this.setZoomWidth(e,r+2*l+"%"),this.broadcastZoomedInEvent();else{var n=r-2*l;this.setZoomWidth(e,(n>100?n:100)+"%"),this.broadcastZoomedOutEvent()}},e.$name="zoomService",e.$inject=["$rootScope"],e}();angular.module("weeklyScheduler").service(ZoomService.$name,ZoomService),angular.module("ngWeeklySchedulerTemplates",[]).run(["$templateCache",function(e){e.put("index.html",'<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><title>Angularjs weekly scheduler demo</title><link rel="stylesheet" href="testStyles.css"></head><body class="container-fluid" ng-app="demoApp"><div class="row" ng-controller="DemoController as demo"><h1>Angularjs weekly scheduler</h1><h2 id="demo" class="page-header">1. Demo</h2><div><code>$scope.model</code><pre ng-bind="model | json" style="max-height: 200px; overflow-y: auto"></pre></div><weekly-scheduler items="model.items" on-change="demo.doSomething(itemIndex, scheduleIndex, scheduleValue)" on-delete="demo.doSomething()" options="model.options"></weekly-scheduler><div class="dark"><weekly-scheduler items="model.items" on-change="demo.doSomething(itemIndex, scheduleIndex, scheduleValue)" on-delete="demo.doSomething()" options="model.options"></weekly-scheduler></div><h2 id="run" class="page-header">2. Run @ Home</h2><p>Run the demo @home with few steps (prerequisite git & node V0.10+ & npm installed):</p><pre>\r\ngit clone https://github.com/brian-rowe/angular-weekly-scheduler.git && cd angular-weekly-scheduler\r\nnpm install\r\n</pre><p>Then run <code>gulp server</code></p><h2 id="install" class="page-header">3. Install</h2><p><code>bower install --save angular-weekly-scheduler</code></p><p>or</p><p><code>npm install --save angular-weekly-scheduler</code></p><p>Add the scripts and css to your index.html.</p><pre>\r\n&lt;link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"&gt;\r\n&lt;script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.10/angular.min.js"&gt;&lt;/script&gt;\r\n&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.13.0/moment.js"&gt;&lt;/script&gt;\r\n\r\n&lt;!-- The library to replace with your local copy of ng-weekly-scheduler --&gt;\r\n&lt;script src="https://github.com/brian-rowe/angular-weekly-scheduler/blob/master/dist/js/ng-weekly-scheduler.js"&gt;&lt;/script&gt;</pre><p>Add dependency to timeline your angular module: weeklyScheduler.</p><p>Use the directive:</p><code>&lt;weekly-scheduler class="scheduler" ng-model="myScopeModel" options="options"&gt;&lt;/weekly-scheduler&gt;</code><h2 id="features" class="page-header">4. Features</h2><p>This directive displays a weekly item scheduler. You can see, add and modify items easily.</p><h3>Keyboard shortcuts</h3><ul><li>Use <kbd>mouse wheel</kbd> on schedule to scroll left and right</li><li>Use <kbd>ctrl + mouse wheel</kbd> to zoom in and out the schedule</li></ul><hr><h3>Schedules</h3><div class="alert alert-info alert-dismissible fade in" role="alert">This directive uses <a href="http://momentjs.com/"><strong>MomentJS</strong> </a>to position items and calculate localized calendar weeks.</div><p>Drag the time bar start, end and body to quickly change your schedule period.</p><p>You can set an <code>editable</code> variable on each item, that will be used to disable item edition if <code>false</code>.<pre>\r\n"items": [{\r\n  "label": "Item 1",\r\n  "editable": false,\r\n  "schedules": [\r\n    {\r\n      "start": "2015-12-26T23:00:00.000Z",\r\n      "end": "2016-07-31T22:00:00.000Z"\r\n    }\r\n  ]\r\n}, ...]</pre></p><hr><h3>Transclusion</h3><p>This directive is using <code>ng-transclude</code> so that everything in <code>&lt;weekly-scheduler&gt;</code> element will be treated as the labelling object of one item.</p><pre>&lt;div class="srow"&gt;\\{\\{::$index + 1\\}\\}. \\{\\{ item.label \\}\\}&lt;/div&gt;</pre><p>On transcluded item label, the scope contains <code>item</code> attribute name containing each item model and regular <code>ng-repeat</code> scope attributes</p><h3>Animation</h3><p>You can add animation to the weekly scheduler directive easily by importing angular module <code>ngAnimate</code>.<br>Your application could for instance use :</p><pre>angular.module(\'demoApp\', [\'ngAnimate\', \'weeklyScheduler\'])</pre><p>Don\'t forget to add the angular-animate javascript file to your Single Page App <code>index.html</code>.</p><pre>&lt;script src="/vendor/angular-animate/angular-animate.js"&gt;&lt;/script&gt;</pre><p>Styling can be changed to whatever you like. This is an example of fading-in items entering the DOM :</p><pre>.schedule-animate {\r\n  transition: opacity 200ms ease-out;\r\n}\r\n.schedule-animate.ng-enter, .schedule-animate.ng-hide-remove {\r\n  opacity: 0;\r\n}\r\n.schedule-animate.ng-leave, .schedule-animate.ng-hide-add {\r\n  display: none;\r\n  opacity: 1;\r\n}</pre><p>You should see your scheduler items fading in!</p></div><script src="testVendorScripts.js"><\/script><script src="testScripts.js"><\/script></body></html>'),e.put("ng-weekly-scheduler/multislider/multislider.html",'<div class="slot ghost" ng-click="multiSliderCtrl.onHoverElementClick()" ng-show="multiSliderCtrl.item.editable !== false && (!multiSliderCtrl.config.monoSchedule || !multiSliderCtrl.item.schedules.length) && !multiSliderCtrl.isDragging && !multiSliderCtrl.isHoveringSlot">+</div><weekly-slot class="slot" config="multiSliderCtrl.config" item="multiSliderCtrl.item" item-index="multiSliderCtrl.index" ng-class="{active: schedule.isActive, disable: multiSliderCtrl.item.editable === false}" ng-repeat="schedule in multiSliderCtrl.item.schedules" ng-model="schedule" ng-model-options="{ updateOn: \'default blur\' }" ng-mouseleave="multiSliderCtrl.onWeeklySlotMouseLeave()" ng-mouseover="multiSliderCtrl.onWeeklySlotMouseOver()" ng-style="{\r\n                 left: multiSliderCtrl.getSlotLeft(schedule.start),\r\n                 right: multiSliderCtrl.getSlotRight(schedule.end) \r\n             }" schedule-index="$index"></weekly-slot>'),e.put("ng-weekly-scheduler/weekly-scheduler/weekly-scheduler.html",'<div class="labels"><div class="srow dummy"></div><div class="srow schedule-animate" ng-repeat="item in schedulerCtrl.items">{{ item.label }}</div></div><schedule-area-container><div class="schedule-area"><div class="srow timestamps"><hourly-grid></hourly-grid></div><div class="srow calendar schedule-animate" ng-repeat="item in schedulerCtrl.items"><hourly-grid no-text></hourly-grid><multi-slider config="schedulerCtrl.config" item="item" index="$index"></multi-slider></div></div></schedule-area-container>'),e.put("ng-weekly-scheduler/weekly-slot/weekly-slot.html",'<div title="{{weeklySlotCtrl.schedule.start | timeOfDay}} - {{weeklySlotCtrl.schedule.end | timeOfDay}}"><div class="handle left" ng-click="weeklySlotCtrl.editSelf()" ondrag="weeklySlotCtrl.resize(delta)" ondragstart="weeklySlotCtrl.startResizeStart()" ondragstop="weeklySlotCtrl.endDrag()" handle></div><div class="middle" ng-click="weeklySlotCtrl.editSelf()" ondrag="weeklySlotCtrl.drag(delta)" ondragstart="weeklySlotCtrl.startDrag()" ondragstop="weeklySlotCtrl.endDrag()" handle>{{weeklySlotCtrl.schedule.start | timeOfDay}}-{{weeklySlotCtrl.schedule.end | timeOfDay}}</div><div class="handle right" ng-click="weeklySlotCtrl.editSelf()" ondrag="weeklySlotCtrl.resize(delta)" ondragstart="weeklySlotCtrl.startResizeEnd()" ondragstop="weeklySlotCtrl.endDrag()" handle></div><div class="remove" ng-click="weeklySlotCtrl.deleteSelf()" ng-if="::weeklySlotCtrl.canRemove()">✖</div></div>')}]);