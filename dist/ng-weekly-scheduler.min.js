angular.module("demoApp",["br.weeklyScheduler"]).controller("DemoController",["$q","$scope","$timeout","$log",function(e,t,r,n){t.isDirty=!1,t.model={options:{buttonClasses:["wow!"],createItem:function(e,t){return{day:e,schedules:t}},defaultValue:!0,editSlot:function(e){return r(function(){return e},0)},interval:1,onChange:function(e){t.isDirty=!0,t.isValid=e,console.log("The model has changed!")}}},t.model2=angular.copy(t.model),t.model2.options.interval=15,t.adapter=new DemoAdapter([{day:6,start:600,end:900,value:!0},{day:0,start:720,end:1020,value:!0},{day:1,start:60,end:180,value:!0},{day:2,start:30,end:300,value:!0},{day:4,start:0,end:60,value:!0}]),t.adapterTwo=new DemoAdapter(JSON.parse('[{"$class":"Unoccupied","day":3,"start":0,"end":135,"value":"Unoccupied"},{"$class":"Setpointd0f1df","day":3,"start":135,"end":195,"value":"Setpointd0f1df"},{"$class":"Unoccupied","day":3,"start":195,"end":225,"value":"Unoccupied"},{"$class":"Unoccupied","day":3,"start":225,"end":270,"value":"Unoccupied"},{"$class":"Setpointd0f1df","day":3,"start":270,"end":330,"value":"Setpointd0f1df"},{"$class":"Setpointd0f1df","day":3,"start":330,"end":360,"value":"Setpointd0f1df"},{"$class":"Setpointd0f1df","day":3,"start":360,"end":510,"value":"Setpointd0f1df"},{"$class":"Unoccupied","day":3,"start":510,"end":585,"value":"Unoccupied"},{"$class":"Unoccupied","day":3,"start":585,"end":630,"value":"Unoccupied"},{"$class":"Unoccupied","day":3,"start":630,"end":675,"value":"Unoccupied"},{"$class":"Unoccupied","day":3,"start":675,"end":690,"value":"Unoccupied"},{"$class":"Unoccupied","day":3,"start":690,"end":810,"value":"Unoccupied"},{"$class":"Unoccupied","day":3,"start":810,"end":0,"value":"Unoccupied"}]')),t.saveAll=function(){t.result=JSON.stringify(t.adapter.getSnapshot())+JSON.stringify(t.adapterTwo.getSnapshot())}}]);var DemoAdapter=function(){function e(e){this.initialData=e,this.items=[]}return e.prototype.getSnapshot=function(){return Array.prototype.concat.apply([],this.items.map(function(e){return e.schedules.map(function(e){return e})}))},e.prototype.customModelToWeeklySchedulerRange=function(e){return e},e}();angular.module("br.weeklyScheduler",["ngWeeklySchedulerTemplates"]);var GhostSlotController=function(){function e(e,t){this.$element=e,this.$timeout=t,this.isDragging=!1}return e.prototype.$postLink=function(){this.$element.addClass("slot"),this.multiSliderCtrl.$hoverElement=this.$element},e.prototype.drag=function(e){this.isDragging&&this.multiSliderCtrl.adjustGhost(e)},e.prototype.startDrag=function(){var e=this;this.dragTimeout=this.$timeout(function(){e.isDragging=!0,e.$element.addClass("active")},250)},e.prototype.stopDrag=function(){this.$timeout.cancel(this.dragTimeout),this.isDragging=!1,this.$element.removeClass("active"),this.multiSliderCtrl.onHoverElementClick()},e.$name="brGhostSlotController",e.$controllerAs="ghostSlotCtrl",e.$inject=["$element","$timeout"],e}(),GhostSlotComponent=function(){function e(){this.controller=GhostSlotController.$name,this.controllerAs=GhostSlotController.$controllerAs,this.require={multiSliderCtrl:"^brMultiSlider"},this.template='\n        <div br-handle\n             ondragstart="ghostSlotCtrl.startDrag()"\n             ondrag="ghostSlotCtrl.drag(event)"\n             ondragstop="ghostSlotCtrl.stopDrag()"\n        >\n        +\n        </div>\n    '}return e.$name="brGhostSlot",e}();angular.module("br.weeklyScheduler").controller(GhostSlotController.$name,GhostSlotController).component(GhostSlotComponent.$name,new GhostSlotComponent);var GroupService=function(){function e(){}return e.prototype.groupSchedules=function(e){return e.reduce(function(e,t,r,n){var l=t.day;return e[l]||(e[l]=[]),e[l].push(t),e},{})},e.$name="brWeeklySchedulerGroupService",e}();angular.module("br.weeklyScheduler").service(GroupService.$name,GroupService);var HandleDirective=function(){function e(e){var t=this;this.$document=e,this.restrict="A",this.scope={ondrag:"&",ondragstop:"&",ondragstart:"&"},this.link=function(e,r){var n=t.$document,l=0,i="mousemove touchmove",o="mouseup touchend";function a(e){return e.pageX||function(e){if(e.originalEvent){if(e.originalEvent.touches&&e.originalEvent.touches.length)return e.originalEvent.touches;if(e.originalEvent.changedTouches&&e.originalEvent.changedTouches.length)return e.originalEvent.changedTouches}e.touches||(e.touches=[e.originalEvent]);return e.touches}(e)[0].pageX}function s(t){var r=a(t)-l;angular.isFunction(e.ondrag)&&e.$apply(e.ondrag({delta:r,event:t}))}function u(){n.unbind(i,s),n.unbind(o,u),angular.isFunction(e.ondragstop)&&e.$apply(e.ondragstop())}r.on("mousedown touchstart",function(t){l=a(t),t.preventDefault(),n.on(i,s),n.on(o,u),angular.isFunction(e.ondragstart)&&e.$apply(e.ondragstart())})}}return e.Factory=function(){var t=function(t){return new e(t)};return t.$inject=["$document"],t},e.$name="brHandle",e}();angular.module("br.weeklyScheduler").directive(HandleDirective.$name,HandleDirective.Factory());var HourlyGridDirective=function(){function e(){var e=this;this.restrict="E",this.require="^brWeeklyScheduler",this.GRID_TEMPLATE=angular.element('<div class="grid-item"></div>'),this.link=function(t,r,n,l){l.config&&e.doGrid(t,r,n,l.config)}}return e.prototype.handleClickEvent=function(e,t,r,n){e.bind("click",function(){n.$apply(function(){n.$emit("clickOnACell",{nbElements:t,idx:r})})})},e.prototype.doGrid=function(e,t,r,n){var l=n.hourCount,i=this.GRID_TEMPLATE.clone();t.empty(),t.addClass("striped");for(var o=0;o<l;o++){var a=i.clone();if(angular.isUndefined(r.noText)){this.handleClickEvent(a,l,o,e);var s=o%12,u=o>=12?"p":"a";a.text(""+(s||"12")+u)}else for(var d=60/n.interval,c=100/d,h=0;h<d;h++){var p=this.GRID_TEMPLATE.clone();p.attr("rel",(o*d+h)*n.interval),p.addClass("interval"),p.css("width",c+"%"),a.append(p)}t.append(a)}},e.Factory=function(){return function(){return new e}},e.$name="brHourlyGrid",e}();angular.module("br.weeklyScheduler").directive(HourlyGridDirective.$name,HourlyGridDirective.Factory());var MultiSliderController=function(){function e(e,t,r,n,l,i){var o,a=this;this.$element=e,this.$q=t,this.$scope=r,this.$window=n,this.nullEndWidth=l,this.overlapService=i,this.overlapHandlers=((o={})[0]=function(e,t){return a.handleNoOverlap(e,t)},o[1]=function(e,t){return a.handleCurrentIsInsideOther(e,t)},o[2]=function(e,t){return a.handleCurrentCoversOther(e,t)},o[3]=function(e,t){return a.handleOtherEndIsInsideCurrent(e,t)},o[4]=function(e,t){return a.handleOtherStartIsInsideCurrent(e,t)},o[5]=function(e,t){return a.handleOtherEndIsCurrentStart(e,t)},o[6]=function(e,t){return a.handleOtherStartIsCurrentEnd(e,t)},o),this.canAdd=!0,this.isAdding=!1,this.isDragging=!1,this.isHoveringSlot=!1,this.element=this.$element[0]}return e.prototype.$onInit=function(){this.mergeAllOverlaps()},e.prototype.$postLink=function(){var e=this;this.$hoverElement.length&&this.element.addEventListener("mousemove",function(t){var r=1===t.buttons,n=e.getGhostLeftVal(t);if(!r){var l=e.getSlotLeft(n),i=e.config.nullEnds?e.getSlotRight(n,n+e.nullEndWidth):e.getSlotRight(n,n+60);e.$hoverElement.css({left:l,right:i})}})},e.prototype.addSlot=function(e,t){var r=this;e<0&&(e=0),t>this.config.maxValue&&(t=this.config.maxValue);var n=this.item;if(n.schedules||(n.schedules=[]),t<=e)return this.$q.when();var l={day:this.item.day,start:e,end:t,value:this.config.defaultValue};return angular.isFunction(this.schedulerCtrl.config.editSlot)?this.schedulerCtrl.config.editSlot(l).then(function(e){r.addScheduleToItem(e)}):this.$q.when(this.addScheduleToItem(l))},e.prototype.adjustGhost=function(e){var t=this.getGhostLeftVal(e),r=this.$hoverElement.css("left"),n=this.pixelToVal(e.pageX),l=this.getSlotRight(t,n);this.$hoverElement.css({left:r,right:l})},e.prototype.setDirty=function(){this.schedulerCtrl.dirty=!0},e.prototype.addScheduleToItem=function(e){this.item.schedules.push(e),this.merge(e),this.setDirty()},e.prototype.getElementOffsetX=function(e){return e[0].getBoundingClientRect().left},e.prototype.onHoverElementClick=function(){var e=this;if(this.canAdd){var t=this.getElementOffsetX(this.$element),r=this.getElementOffsetX(this.$hoverElement)-t,n=this.pixelToVal(r),l=this.pixelToVal(this.$hoverElement[0].clientWidth),i=this.config.nullEnds?null:this.adjustEndForModel(n+l);this.isAdding=!0,this.addSlot(n,i).then(function(){e.onChange(),e.isAdding=!1})}},e.prototype.adjustEndForModel=function(e){return e===this.config.maxValue&&(e=0),e},e.prototype.canEdit=function(e){var t=!angular.isDefined(this.item.editable)||this.item.editable,r=angular.isFunction(this.schedulerCtrl.config.editSlot),n=!e.$isActive,l=!this.isDragging;return t&&r&&n&&l},e.prototype.canRenderGhost=function(e){return this.config.nullEnds?0===this.item.schedules.length:!(angular.isDefined(this.item.editable)&&!this.item.editable)&&(!this.isAdding&&(!this.isDragging&&!this.isHoveringSlot))},e.prototype.getGhostLeftPixel=function(e){var t=this.getElementOffsetX(this.$element);return e.pageX-t},e.prototype.getGhostLeftVal=function(e){return this.pixelToVal(this.getGhostLeftPixel(e))},e.prototype.editSchedule=function(e){var t=this;this.canEdit(e)&&(e.$isEditing=!0,this.schedulerCtrl.config.editSlot(e).then(function(r){if(r.$isDeleting)t.removeSchedule(e);else{var n=angular.copy(r);t.merge(r),angular.equals(n,r)&&t.updateSchedule(e,r)}}).finally(function(){t.setDirty(),e.$isEditing=!1}))},e.prototype.getOverlapState=function(e,t){return this.overlapService.getOverlapState(e.start,this.adjustEndForView(e.end),t.start,this.adjustEndForView(t.end))},e.prototype.getSlotLeft=function(e){return this.getUnderlyingInterval(e).offsetLeft+"px"},e.prototype.getSlotRight=function(e,t){this.config.nullEnds&&null===t&&(t=e+this.nullEndWidth),t=this.adjustEndForView(t);var r=this.getUnderlyingInterval(t-this.config.interval),n=r.offsetLeft+r.offsetWidth,l=this.getElementOffsetX(this.$element);return this.$element[0].getBoundingClientRect().right-l-n+"px"},e.prototype.getUnderlyingInterval=function(e){e<0&&(e=0);var t=this.config.maxValue-this.config.interval;return e>t&&(e=t),this.$element.parent()[0].querySelector("[rel='"+e+"']")},e.prototype.handleCurrentCoversOther=function(e,t){this.removeSchedule(t)},e.prototype.handleCurrentIsInsideOther=function(e,t){this.valuesMatch(e,t)?(this.removeSchedule(t),this.updateSchedule(e,{day:t.day,start:t.start,end:t.end,value:t.value})):this.removeSchedule(e)},e.prototype.handleNoOverlap=function(e,t){},e.prototype.handleOtherEndIsInsideCurrent=function(e,t){this.valuesMatch(e,t)?(this.removeSchedule(t),this.updateSchedule(e,{day:e.day,start:t.start,end:e.end,value:t.value})):this.updateSchedule(t,{day:t.day,start:t.start,end:e.start,value:e.value})},e.prototype.handleOtherStartIsInsideCurrent=function(e,t){this.valuesMatch(e,t)?(this.removeSchedule(t),this.updateSchedule(e,{day:e.day,start:e.start,end:t.end,value:t.value})):this.updateSchedule(t,{day:t.day,start:e.end,end:t.end,value:t.value})},e.prototype.handleOtherEndIsCurrentStart=function(e,t){this.valuesMatch(e,t)&&this.handleOtherEndIsInsideCurrent(e,t)},e.prototype.handleOtherStartIsCurrentEnd=function(e,t){this.valuesMatch(e,t)&&this.handleOtherStartIsInsideCurrent(e,t)},e.prototype.needsOverlapsMerged=function(){for(var e=this.item.schedules.length,t=0;t<e-1;t+=1){var r=this.item.schedules[t],n=this.item.schedules[t+1];if(r.value===n.value){var l=this.getOverlapState(r,n);return[5,6].indexOf(l)>-1}}return!1},e.prototype.mergeAllOverlaps=function(){var e=this;do{this.item.schedules.forEach(function(t){return e.mergeOverlaps(t)})}while(this.needsOverlapsMerged())},e.prototype.mergeOverlaps=function(e){var t=this;this.item.schedules.forEach(function(r){if(r!==e){var n=t.getOverlapState(e,r);(0,t.overlapHandlers[n])(e,r)}})},e.prototype.onChange=function(){this.schedulerCtrl.config.onChange(!this.schedulerCtrl.hasInvalidSchedule())},e.prototype.onWeeklySlotMouseOver=function(){this.isHoveringSlot=!0},e.prototype.onWeeklySlotMouseLeave=function(){this.isHoveringSlot=!1},e.prototype.removeSchedule=function(e){this.isDragging=!1,this.isHoveringSlot=!1;var t=this.item.schedules;t.splice(t.indexOf(e),1),this.setDirty()},e.prototype.updateSchedule=function(e,t){e.start=t.start,e.end=this.adjustEndForModel(t.end),this.onChange()},e.prototype.valuesMatch=function(e,t){return e.value===t.value},e.prototype.adjustEndForView=function(e){return 0===e&&(e=this.config.maxValue),e},e.prototype.merge=function(e){this.mergeOverlaps(e),this.mergeAllOverlaps()},e.prototype.pixelToVal=function(e){var t=e/this.element.clientWidth;return Math.floor(t*this.config.intervalCount+.5)*this.config.interval},e.$name="brMultiSliderController",e.$controllerAs="multiSliderCtrl",e.$inject=["$element","$q","$scope","$window","brWeeklySchedulerNullEndWidth","brWeeklySchedulerOverlapService"],e}(),MultiSliderComponent=function(){function e(){this.bindings={config:"<",item:"=",index:"<",size:"<?"},this.controller=MultiSliderController.$name,this.controllerAs=MultiSliderController.$controllerAs,this.require={schedulerCtrl:"^brWeeklyScheduler"},this.templateUrl="ng-weekly-scheduler/multislider/multislider.html"}return e.$name="brMultiSlider",e}();angular.module("br.weeklyScheduler").controller(MultiSliderController.$name,MultiSliderController).component(MultiSliderComponent.$name,new MultiSliderComponent);var OverlapService=function(){function e(){}return e.prototype.getOverlapState=function(e,t,r,n){return n>=t&&r<=e?1:t>=n&&e<=r?2:n>e&&n<=t?3:r>=e&&r<t?4:n===e&&n<=t?5:r===t&&r<=t?6:0},e.$name="brWeeklySchedulerOverlapService",e}();angular.module("br.weeklyScheduler").service(OverlapService.$name,OverlapService);var ResizeServiceProvider=function(){function e(){this.customResizeEvents=[],this.serviceInitialized=!1,this.$get.$inject=["$rootScope","$window"]}return e.prototype.setCustomResizeEvents=function(e){this.customResizeEvents=e},e.prototype.$get=function(e,t){var r=this;return{initialize:function(){r.serviceInitialized||(t.addEventListener("resize",function(){e.$apply(function(){e.$broadcast("resized")})}),r.customResizeEvents&&r.customResizeEvents.forEach(function(t){e.$on(t,function(){e.$broadcast("resized")})}),r.serviceInitialized=!0)}}},e.$name="br.weeklyScheduler.resizeService",e}();angular.module("br.weeklyScheduler").provider(ResizeServiceProvider.$name,ResizeServiceProvider).run([ResizeServiceProvider.$name,function(e){return e.initialize()}]);var RestrictionExplanationsController=function(){function e(e){this.$filter=e,this.explanations={},this.violations={}}return e.prototype.$doCheck=function(){var e,t=this.schedulerCtrl.validationErrors;this.violations=((e={}).fullCalendarViolation=t.indexOf("fullCalendarViolation")>-1,e.maxTimeSlotViolation=t.indexOf("maxTimeSlotViolation")>-1,e.monoScheduleViolation=t.indexOf("monoScheduleViolation")>-1,e)},e.prototype.$onInit=function(){var e=this.schedulerCtrl.config;if(e.maxTimeSlot){var t=this.$filter("brWeeklySchedulerMinutesAsText")(e.maxTimeSlot);this.explanations.maxTimeSlotViolation="Max time slot length: "+t}e.fullCalendar&&(this.explanations.fullCalendarViolation="For this calendar, every day must be completely full of schedules."),e.monoSchedule&&(this.explanations.monoScheduleViolation="This calendar may only have one time slot per day"),e.nullEnds&&(this.explanations.nullEndViolation="Items in this calendar do not have end times. Scheduled events begin at the start time and end when they are finished.")},e.$controllerAs="restrictionExplanationsCtrl",e.$name="brWeeklySchedulerRestrictionExplanationsController",e.$inject=["$filter"],e}(),RestrictionExplanationsComponent=function(){function e(){this.controller=RestrictionExplanationsController.$name,this.controllerAs=RestrictionExplanationsController.$controllerAs,this.require={schedulerCtrl:"^brWeeklyScheduler"},this.template='\n        <div class="srow explanations" ng-class="{ violation: restrictionExplanationsCtrl.violations[key] }" ng-repeat="(key, explanation) in restrictionExplanationsCtrl.explanations">\n            {{ explanation }}\n        </div>\n    '}return e.$name="brRestrictionExplanations",e}();angular.module("br.weeklyScheduler").component(RestrictionExplanationsComponent.$name,new RestrictionExplanationsComponent).controller(RestrictionExplanationsController.$name,RestrictionExplanationsController);var ScheduleAreaContainerController=function(){function e(e,t,r,n){this.$element=e,this.$scope=t,this.scrollService=r,this.zoomService=n}return e.prototype.$postLink=function(){var e=this,t=this.$element[0];this.scrollService.hijackScroll(t,20),this.zoomService.resetZoom(t),this.$scope.$on("clickOnACell",function(r,n){e.zoomService.zoomInACell(t,r,n)}),this.$scope.$on("resetZoom",function(r){e.zoomService.resetZoom(t)}),this.$scope.$on("zoomIn",function(r){e.zoomService.zoomIn(t)})},e.$name="brWeeklySchedulerScheduleAreaContainerController",e.$inject=["$element","$scope","brWeeklySchedulerScrollService","brWeeklySchedulerZoomService"],e}(),ScheduleAreaContainerComponent=function(){function e(){this.controller=ScheduleAreaContainerController.$name,this.transclude=!0,this.template="<ng-transclude></ng-transclude>"}return e.$name="brScheduleAreaContainer",e}();angular.module("br.weeklyScheduler").controller(ScheduleAreaContainerController.$name,ScheduleAreaContainerController).component(ScheduleAreaContainerComponent.$name,new ScheduleAreaContainerComponent);var FullCalendarValidatorService=function(){function e(){}return Object.defineProperty(e.prototype,"error",{get:function(){return"fullCalendarViolation"},enumerable:!0,configurable:!0}),e.prototype.validate=function(e,t){if(!t.fullCalendar)return!0;var r=e.length;if(!r)return!1;if(1===r){var n=e[0];return this.validateStartAtMinValue(n.start)&&this.validateEndAtMaxValue(n.end,t)}for(var l=r-1,i=!0,o=(e.sort(function(e,t){return e.start>t.start?1:-1}),0);o<l;o++){var a=e[o],s=e[o+1];if(0===o&&!this.validateStartAtMinValue(a.start))return!1;if(o===l-1&&!this.validateEndAtMaxValue(s.end,t))return!1;i=i&&a.end===s.start}return i},e.prototype.validateStartAtMinValue=function(e){return 0===e},e.prototype.validateEndAtMaxValue=function(e,t){return(e||t.maxValue)===t.maxValue},e.$name="brWeeklySchedulerFullCalendarValidatorService",e}();angular.module("br.weeklyScheduler").service(FullCalendarValidatorService.$name,FullCalendarValidatorService);var MaxTimeSlotValidatorService=function(){function e(){}return Object.defineProperty(e.prototype,"error",{get:function(){return"maxTimeSlotViolation"},enumerable:!0,configurable:!0}),e.prototype.validate=function(e,t){var r=t.maxTimeSlot;return!r||!e.some(function(e){return e.value!==t.defaultValue&&e.end-e.start>r})},e.$name="brWeeklySchedulerMaxTimeSlotValidatorService",e}();angular.module("br.weeklyScheduler").service(MaxTimeSlotValidatorService.$name,MaxTimeSlotValidatorService);var MonoScheduleValidatorService=function(){function e(){}return Object.defineProperty(e.prototype,"error",{get:function(){return"monoScheduleViolation"},enumerable:!0,configurable:!0}),e.prototype.validate=function(e,t){return!t.monoSchedule||(!(r=angular.isDefined(t.defaultValue)?e.filter(function(e){return e.value!==t.defaultValue}):e).length||1===r.length);var r},e.$name="brWeeklySchedulerMonoScheduleValidatorService",e}();angular.module("br.weeklyScheduler").service(MonoScheduleValidatorService.$name,MonoScheduleValidatorService);var NullEndScheduleValidatorService=function(){function e(){}return Object.defineProperty(e.prototype,"error",{get:function(){return"nullEndViolation"},enumerable:!0,configurable:!0}),e.prototype.validate=function(e,t){return t.nullEnds?e.length<=1&&e.every(function(e){return null===e.end}):e.every(function(e){return null!==e.end})},e.$name="brWeeklySchedulerNullEndValidatorService",e}();angular.module("br.weeklyScheduler").service(NullEndScheduleValidatorService.$name,NullEndScheduleValidatorService);var OverlapValidatorService=function(){function e(e){this.overlapService=e}return Object.defineProperty(e.prototype,"error",{get:function(){return"overlapViolation"},enumerable:!0,configurable:!0}),e.prototype.validate=function(e,t){for(var r=e.length,n=!0,l=0;l<r-1;l++){var i=e[l],o=e[l+1];if(!(i.value===o.value)){var a=t.maxValue,s=this.overlapService.getOverlapState(i.start,i.end||a,o.start,o.end||a);n=n&&[0,6,5].indexOf(s)>-1}}return n},e.$name="brWeeklySchedulerOverlapValidatorService",e.$inject=["brWeeklySchedulerOverlapService"],e}();angular.module("br.weeklyScheduler").service(OverlapValidatorService.$name,OverlapValidatorService);var ScheduleValidationService=function(){function e(e,t,r,n,l){this.fullCalendarValidatorService=e,this.maxTimeSlotValidatorService=t,this.monoScheduleValidatorService=r,this.nullEndScheduleValidatorService=n,this.overlapValidatorService=l}return e.prototype.getValidationErrors=function(e,t){var r=[];return[this.maxTimeSlotValidatorService,this.monoScheduleValidatorService,this.nullEndScheduleValidatorService,this.fullCalendarValidatorService,this.overlapValidatorService].forEach(function(n){n.validate(e.schedules,t)||r.push(n.error)}),r},e.$name="brWeeklySchedulerValidationService",e.$inject=["brWeeklySchedulerFullCalendarValidatorService","brWeeklySchedulerMaxTimeSlotValidatorService","brWeeklySchedulerMonoScheduleValidatorService","brWeeklySchedulerNullEndValidatorService","brWeeklySchedulerOverlapValidatorService"],e}();angular.module("br.weeklyScheduler").service(ScheduleValidationService.$name,ScheduleValidationService);var ScrollService=function(){function e(e){this.zoomService=e}return e.prototype.hijackScroll=function(e,t){var r=this;e.addEventListener("mousewheel",function(n){return n.preventDefault(),n.stopPropagation(),n.ctrlKey?r.zoomService.zoomByScroll(e,n,t):(n.wheelDelta||n.detail)>0?e.scrollLeft-=t:e.scrollLeft+=t,!1})},e.$name="brWeeklySchedulerScrollService",e.$inject=["brWeeklySchedulerZoomService"],e}();angular.module("br.weeklyScheduler").service(ScrollService.$name,ScrollService);var MinutesAsTextFilter=function(){function e(){}return e.Factory=function(){return function(e){var t="",r=Math.floor(e/60),n=r>0;n&&(t+=r+" hours");var l=e%60;return l>0&&(n&&(t+=" "),t+=l+" minute"+(l>1?"s":"")),t||(t="none"),t}},e.$name="brWeeklySchedulerMinutesAsText",e}();angular.module("br.weeklyScheduler").filter(MinutesAsTextFilter.$name,[MinutesAsTextFilter.Factory]);var TimeOfDayFilter=function(){function e(){}return e.Factory=function(){return function(e){var t=Math.floor(e/60),r=(e-60*t).toString(),n=t>11&&t<24?"P":"A";return 1==r.length&&(r="0"+r),(t%12||12)+":"+r+n}},e.$name="brWeeklySchedulerTimeOfDay",e}();angular.module("br.weeklyScheduler").filter(TimeOfDayFilter.$name,[TimeOfDayFilter.Factory]);var TimeRangeComponent=function(){function e(){this.bindings={schedule:"<"},this.controller=TimeRangeController.$name,this.controllerAs=TimeRangeController.$controllerAs,this.template='\n        <span ng-if="timeRangeCtrl.hasStart && timeRangeCtrl.hasEnd">{{ timeRangeCtrl.schedule.start | brWeeklySchedulerTimeOfDay }}-{{ timeRangeCtrl.schedule.end | brWeeklySchedulerTimeOfDay }}</span>\n        <span ng-if="timeRangeCtrl.hasStart && !timeRangeCtrl.hasEnd">{{ timeRangeCtrl.schedule.start | brWeeklySchedulerTimeOfDay }} until</span>\n    '}return e.$name="brTimeRange",e}(),TimeRangeController=function(){function e(){}return e.prototype.$onInit=function(){this.hasStart=angular.isDefined(this.schedule.start),this.hasEnd=angular.isDefined(this.schedule.end)&&null!==this.schedule.end},e.$controllerAs="timeRangeCtrl",e.$name="brTimeRangeController",e}();angular.module("br.weeklyScheduler").component(TimeRangeComponent.$name,new TimeRangeComponent).controller(TimeRangeController.$name,TimeRangeController);var WeeklySchedulerController=function(){function e(e,t,r,n,l,i){this.$element=e,this.$q=t,this.$scope=r,this.groupService=n,this.dayMap=l,this.scheduleValidatorService=i,this.defaultOptions={createItem:function(e,t){return{day:e,schedules:t}},monoSchedule:!1,onChange:function(e){return angular.noop()}}}return e.prototype.$doCheck=function(){var e=this.getValidationErrors();e&&(this.validationErrors=e)},e.prototype.$onInit=function(){this.config=this.configure(this.options),this.buildItemsFromAdapter(),this.startedWithInvalidSchedule=this.hasInvalidSchedule(),this.watchAdapter(),this.watchHoverClass()},e.prototype.hasInvalidSchedule=function(){return this.getValidationErrors().length>0},e.prototype.buildItems=function(e){this.items=this.fillItems(e),this.adapter.items=this.items,this._originalItems=angular.copy(this.items)},e.prototype.buildItemsFromAdapter=function(){return this.buildItems(this.getItemsFromAdapter())},e.prototype.getItemsFromAdapter=function(){var e=this,t=[];if(this.adapter){var r=this.adapter.initialData.map(function(t){return e.adapter.customModelToWeeklySchedulerRange(t)}),n=this.groupService.groupSchedules(r);for(var l in n){var i=this.createItem(parseInt(l,10),n[l]);t.push(i)}}return t},e.prototype.getValidationErrors=function(){var e=this;return Array.prototype.concat.apply([],this.items.map(function(t){return e.scheduleValidatorService.getValidationErrors(t,e.config)}))},e.prototype.configure=function(e){var t=e.interval||15,r=1440/t,n=angular.extend(this.defaultOptions,e);return angular.extend(n,{interval:t,maxValue:1440,hourCount:24,intervalCount:r})},e.prototype.createItem=function(e,t){var r=this.config.createItem(e,t);return angular.extend(r,{label:this.dayMap[e]})},e.prototype.fillItems=function(e){var t=this,r=[];return angular.forEach(this.dayMap,function(n,l){var i=parseInt(l,10),o=e.filter(function(e){return e.day===i}),a=o.length?o[0]:null;a?(a.label=n,r.push(a)):r.push(t.createItem(i,[]))}),angular.copy(r).sort(function(e,t){return e.day>t.day?1:-1})},e.prototype.resetZoom=function(){this.$scope.$broadcast("resetZoom")},e.prototype.zoomIn=function(){this.$scope.$broadcast("zoomIn")},e.prototype.rollback=function(){this.buildItems(this._originalItems),this.dirty=!1},e.prototype.save=function(){var e=this;return this.config.saveScheduler().then(function(){return e.dirty=!1})},e.prototype.watchAdapter=function(){var e=this;this.$scope.$watch(function(){return e.adapter},function(){e.buildItemsFromAdapter()})},e.prototype.watchHoverClass=function(){var e=this;this.$scope.$watch(function(){return e.hoverClass},function(){e.$element.find(".pulse").removeClass("pulse"),e.hoverClass&&e.$element.find("."+e.hoverClass).addClass("pulse")})},e.$controllerAs="schedulerCtrl",e.$name="brWeeklySchedulerController",e.$inject=["$element","$q","$scope","brWeeklySchedulerGroupService","brWeeklySchedulerDayMap","brWeeklySchedulerValidationService"],e}(),WeeklySchedulerComponent=function(){function e(){this.bindings={adapter:"<",hoverClass:"<",options:"="},this.controller=WeeklySchedulerController.$name,this.controllerAs=WeeklySchedulerController.$controllerAs,this.transclude=!0,this.templateUrl="ng-weekly-scheduler/weekly-scheduler/weekly-scheduler.html"}return e.$name="brWeeklyScheduler",e}();angular.module("br.weeklyScheduler").controller(WeeklySchedulerController.$name,WeeklySchedulerController).component(WeeklySchedulerComponent.$name,new WeeklySchedulerComponent);var DayMap=function(){function e(){}return e.$name="brWeeklySchedulerDayMap",e.value={0:"Mon",1:"Tue",2:"Wed",3:"Thur",4:"Fri",5:"Sat",6:"Sun"},e}();angular.module("br.weeklyScheduler").constant(DayMap.$name,DayMap.value);var NullEndWidth=function(){function e(){}return e.$name="brWeeklySchedulerNullEndWidth",e.value=120,e}();angular.module("br.weeklyScheduler").constant(NullEndWidth.$name,NullEndWidth.value);var WeeklySlotController=function(){function e(e,t,r,n){this.$scope=e,this.$timeout=t,this.nullEndWidth=r,this.overlapService=n,this.resizeDirectionIsStart=!0}return e.prototype.$onInit=function(){this.valuesOnDragStart=this.getDragStartValues()},e.prototype.cancelDragIfThresholdExceeded=function(e){e>3&&this.cancelDrag()},e.prototype.cancelDrag=function(){this.$timeout.cancel(this.startDragTimeout)},e.prototype.getDragStartValues=function(){return{day:this.schedule.day,start:this.schedule.start,end:this.config.nullEnds?this.multisliderCtrl.adjustEndForView(this.schedule.start+this.nullEndWidth):this.multisliderCtrl.adjustEndForView(this.schedule.end),value:this.schedule.value}},e.prototype.deleteSelf=function(){this.removeSchedule({schedule:this.schedule})},e.prototype.editSelf=function(){this.editSchedule({schedule:this.schedule})},e.prototype.drag=function(e){if(this.schedule.$isActive){this.multisliderCtrl.isDragging=!0;var t=this.schedule,r=this.multisliderCtrl.pixelToVal(e),n=this.valuesOnDragStart.end-this.valuesOnDragStart.start,l=Math.round(this.valuesOnDragStart.start+r),i=this.config.nullEnds?null:Math.round(l+n);t.start!==l&&l>=0&&i<=this.config.maxValue&&this.updateSelf({day:t.day,start:l,end:i,value:t.value})}else this.cancelDragIfThresholdExceeded(e)},e.prototype.endDrag=function(){var e=this;if(this.cancelDrag(),!this.schedule.$isActive)return this.editSelf();this.$timeout(function(){e.multisliderCtrl.canAdd=!0,e.schedule.$isActive=!1,e.multisliderCtrl.isDragging=!1},200).then(function(){e.multisliderCtrl.setDirty(),e.multisliderCtrl.merge(e.schedule)})},e.prototype.resize=function(e){if(this.schedule.$isActive){this.multisliderCtrl.isDragging=!0;var t=this.schedule,r=this.multisliderCtrl.pixelToVal(e);this.resizeDirectionIsStart?this.resizeStart(t,r):this.resizeEnd(t,r)}else this.cancelDragIfThresholdExceeded(e)},e.prototype.resizeStart=function(e,t){var r=Math.round(this.valuesOnDragStart.start+t),n=e.start!==r,l=r<=this.multisliderCtrl.adjustEndForView(e.end)-1;n&&l&&r>=0&&this.updateSelf({day:e.day,start:r,end:e.end,value:e.value})},e.prototype.resizeEnd=function(e,t){var r=Math.round(this.valuesOnDragStart.end+t),n=e.end!==r,l=r<=this.config.maxValue,i=r>=e.start+1;n&&i&&l&&this.updateSelf({day:e.day,start:e.start,end:r,value:e.value})},e.prototype.startDrag=function(){var e=this;this.startDragTimeout=this.$timeout(function(){e.schedule.$isActive=!0,e.multisliderCtrl.canAdd=!1},500),this.valuesOnDragStart=this.getDragStartValues()},e.prototype.startResizeStart=function(){this.resizeDirectionIsStart=!0,this.startDrag()},e.prototype.startResizeEnd=function(){this.resizeDirectionIsStart=!1,this.startDrag()},e.prototype.updateSelf=function(e){this.updateSchedule({schedule:this.schedule,update:e})},e.$name="weeklySlotController",e.$controllerAs="weeklySlotCtrl",e.$inject=["$scope","$timeout","brWeeklySchedulerNullEndWidth","brWeeklySchedulerOverlapService"],e}(),WeeklySlotComponent=function(){function e(){this.bindings={config:"<",schedule:"=ngModel",editSchedule:"&",removeSchedule:"&",updateSchedule:"&",item:"="},this.controller=WeeklySlotController.$name,this.controllerAs=WeeklySlotController.$controllerAs,this.require={multisliderCtrl:"^brMultiSlider"},this.templateUrl="ng-weekly-scheduler/weekly-slot/weekly-slot.html"}return e.$name="brWeeklySlot",e}();angular.module("br.weeklyScheduler").controller(WeeklySlotController.$name,WeeklySlotController).component(WeeklySlotComponent.$name,new WeeklySlotComponent);var ZoomService=function(){function e(e){this.$rootScope=e,this.selector=".schedule-area"}return e.prototype.broadcastZoomedInEvent=function(){this.$rootScope.$broadcast("zoomedIn")},e.prototype.broadcastZoomedOutEvent=function(){this.$rootScope.$broadcast("zoomedOut")},e.prototype.getCurrentZoomWidth=function(e){return parseInt(e.querySelector(this.selector).style.width,10)},e.prototype.getZoomElement=function(e){return e.querySelector(this.selector)},e.prototype.setZoomWidth=function(e,t){this.getZoomElement(e).style.width=t},e.prototype.resetZoom=function(e){this.setZoomWidth(e,"100%"),this.broadcastZoomedOutEvent()},e.prototype.zoomIn=function(e){var t=this.getZoomElement(e).style.width,r=2*parseInt(t,10);this.setZoomWidth(e,r+"%"),this.broadcastZoomedInEvent()},e.prototype.zoomInACell=function(e,t,r){var n=r.nbElements,l=r.idx,i=e.offsetWidth,o=i/5,a=2*o,s=n*o/i*100;this.setZoomWidth(e,s+"%"),e.scrollLeft=l*o-a,this.broadcastZoomedInEvent()},e.prototype.zoomByScroll=function(e,t,r){var n=this.getCurrentZoomWidth(e);if((t.wheelDelta||t.detail)>0)this.setZoomWidth(e,n+2*r+"%"),this.broadcastZoomedInEvent();else{var l=n-2*r;this.setZoomWidth(e,(l>100?l:100)+"%"),this.broadcastZoomedOutEvent()}},e.$name="brWeeklySchedulerZoomService",e.$inject=["$rootScope"],e}();angular.module("br.weeklyScheduler").service(ZoomService.$name,ZoomService),angular.module("ngWeeklySchedulerTemplates",[]).run(["$templateCache",function(e){e.put("index.html",'<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><title>Angularjs weekly scheduler demo</title><link rel="stylesheet" href="testStyles.css"></head><body class="container-fluid" ng-app="demoApp"><div class="row" ng-controller="DemoController as demo"><div><code>$scope.model</code><pre ng-bind="model | json" style="max-height: 200px; overflow-y: auto"></pre></div><button ng-click="saveAll()">Save</button><br-weekly-scheduler adapter="adapter" options="model.options"></br-weekly-scheduler><code>Dirty: {{ isDirty }}</code> <code>Valid: {{ isValid }}</code><hr><br-weekly-scheduler adapter="adapterTwo" options="model2.options"></br-weekly-scheduler><hr>Result: {{ result }}<script src="testVendorScripts.js"><\/script><script src="testScripts.js"><\/script></div></body></html>'),e.put("ng-weekly-scheduler/multislider/multislider.html",'<br-ghost-slot ng-show="multiSliderCtrl.canRenderGhost()">+</br-ghost-slot><br-weekly-slot class="slot {{ schedule.$class }}" config="multiSliderCtrl.config" item="multiSliderCtrl.item" ng-class="{\r\n                 active: schedule.$isActive,\r\n                 disable: multiSliderCtrl.item.editable === false,\r\n                 nullEnd: schedule.end === null,\r\n                 pending: schedule.$isEditing\r\n             }" ng-repeat="schedule in multiSliderCtrl.item.schedules" ng-model="schedule" ng-mouseleave="multiSliderCtrl.onWeeklySlotMouseLeave()" ng-mouseover="multiSliderCtrl.onWeeklySlotMouseOver()" ng-style="{\r\n                 left: multiSliderCtrl.getSlotLeft(schedule.start),\r\n                 right: multiSliderCtrl.getSlotRight(schedule.start, schedule.end) \r\n             }" edit-schedule="multiSliderCtrl.editSchedule(schedule)" remove-schedule="multiSliderCtrl.removeSchedule(schedule)" update-schedule="multiSliderCtrl.updateSchedule(schedule, update)"></br-weekly-slot>'),e.put("ng-weekly-scheduler/weekly-scheduler/weekly-scheduler.html",'<div ng-if="!schedulerCtrl.startedWithInvalidSchedule"><div class="labels"><div class="srow dummy"></div><div class="srow schedule-animate" ng-repeat="item in schedulerCtrl.items track by item.day">{{ item.label }}</div></div><br-schedule-area-container><div class="schedule-area"><div class="srow timestamps"><br-hourly-grid></br-hourly-grid></div><div class="srow calendar schedule-animate" ng-repeat="item in schedulerCtrl.items track by item.day"><br-hourly-grid no-text></br-hourly-grid><br-multi-slider config="schedulerCtrl.config" item="item" index="$index"></br-multi-slider></div></div></br-schedule-area-container><br-restriction-explanations></br-restriction-explanations><div class="srow buttons"><button ng-class="schedulerCtrl.config.buttonClasses" type="button" ng-click="schedulerCtrl.rollback()" ng-disabled="!schedulerCtrl.dirty">Reset</button> <button ng-class="schedulerCtrl.config.buttonClasses" type="button" ng-click="schedulerCtrl.save()" ng-disabled="!schedulerCtrl.dirty || schedulerCtrl.validationErrors.length" ng-if="schedulerCtrl.config.saveScheduler">Save</button> <button ng-class="schedulerCtrl.config.buttonClasses" type="button" ng-click="schedulerCtrl.resetZoom()">Zoom Out</button> <button ng-class="schedulerCtrl.config.buttonClasses" type="button" ng-click="schedulerCtrl.zoomIn()">Zoom In</button></div></div><div class="srow" ng-if="schedulerCtrl.startedWithInvalidSchedule">One or more of the schedules is invalid! Please contact service.</div>'),e.put("ng-weekly-scheduler/weekly-slot/weekly-slot.html",'<div class="slotWrapper" title="{{weeklySlotCtrl.schedule.start | brWeeklySchedulerTimeOfDay}} - {{weeklySlotCtrl.schedule.end | brWeeklySchedulerTimeOfDay}}"><div class="handle left" ondrag="weeklySlotCtrl.resize(delta)" ondragstart="weeklySlotCtrl.startResizeStart()" ondragstop="weeklySlotCtrl.endDrag()" br-handle ng-if="!weeklySlotCtrl.config.nullEnds"></div><div class="middle" ondrag="weeklySlotCtrl.drag(delta)" ondragstart="weeklySlotCtrl.startDrag()" ondragstop="weeklySlotCtrl.endDrag()" br-handle><br-time-range schedule="weeklySlotCtrl.schedule"></br-time-range></div><div class="handle right" ondrag="weeklySlotCtrl.resize(delta)" ondragstart="weeklySlotCtrl.startResizeEnd()" ondragstop="weeklySlotCtrl.endDrag()" br-handle ng-if="!weeklySlotCtrl.config.nullEnds"></div></div>')}]);