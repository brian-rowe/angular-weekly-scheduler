angular.module("demoApp",["ngAnimate","weeklyScheduler","weeklySchedulerI18N"]).config(["weeklySchedulerLocaleServiceProvider",function(e){e.configure({doys:{"es-es":4},lang:{"es-es":{addNew:"Añadir"}},localeLocationPattern:"/angular-locale_{{locale}}.js"})}]).controller("DemoController",["$scope","$timeout","weeklySchedulerLocaleService","$log",function(e,t,l,n){e.model={locale:l.$locale.id,options:{},items:[{label:"Sun",schedules:[]},{label:"Mon",schedules:[]},{label:"Tue",schedules:[]},{label:"Wed",schedules:[]},{label:"Thur",editable:!1,schedules:[]},{label:"Fri",schedules:[]},{label:"Sat",schedules:[]}]},this.doSomething=function(e,t,l){console.log("The model has changed!",e,t,l)},this.onLocaleChange=function(){n.debug("The locale is changing to",e.model.locale),l.set(e.model.locale).then(function(e){n.debug("The locale changed to",e.id)})}}]),angular.module("weeklyScheduler",["ngWeeklySchedulerTemplates"]);var GRID_TEMPLATE=angular.element('<div class="grid-item"></div>'),HandleDirective=function(){function e(e){var t=this;this.$document=e,this.restrict="A",this.scope={ondrag:"&",ondragstop:"&",ondragstart:"&"},this.link=function(e,l){var n=t.$document,o=0;function r(t){var l=t.pageX-o;angular.isFunction(e.ondrag)&&e.ondrag({delta:l})}function i(){n.unbind("mousemove",r),n.unbind("mouseup",i),angular.isFunction(e.ondragstop)&&e.ondragstop()}l.on("mousedown",function(t){t.preventDefault(),o=t.pageX,n.on("mousemove",r),n.on("mouseup",i),angular.isFunction(e.ondragstart)&&e.ondragstart()})}}return e.Factory=function(){var t=function(t){return new e(t)};return t.$inject=["$document"],t},e.$name="handle",e}();angular.module("weeklyScheduler").directive(HandleDirective.$name,HandleDirective.Factory());var HourlyGridDirective=function(){function e(){var e=this;this.restrict="E",this.require="^weeklyScheduler",this.link=function(t,l,n,o){o.config&&e.doGrid(t,l,n,o.config),o.$modelChangeListeners.push(function(o){e.doGrid(t,l,n,o)})}}return e.prototype.handleClickEvent=function(e,t,l,n){e.bind("click",function(){n.$emit("clickOnACell",{nbElements:t,idx:l})})},e.prototype.doGrid=function(e,t,l,n){var o,r=n.hourCount,i=100/r,s=GRID_TEMPLATE.clone().css({width:i+"%"});for(t.empty(),o=0;o<r;o++){var a=s.clone();if(angular.isUndefined(l.noText)){this.handleClickEvent(a,r,o,e);var c=o%12,d=o>=12?"pm":"am";a.text(""+(c||"12")+d)}t.append(a)}},e.Factory=function(){return function(){return new e}},e.$name="hourlyGrid",e}();angular.module("weeklyScheduler").directive(HourlyGridDirective.$name,HourlyGridDirective.Factory());var IntervalGridDirective=function(){function e(){var e=this;this.restrict="E",this.require="^weeklyScheduler",this.link=function(t,l,n,o){o.config&&e.doGrid(t,l,n,o.config),o.$modelChangeListeners.push(function(o){e.doGrid(t,l,n,o)})}}return e.prototype.doGrid=function(e,t,l,n){var o=n.intervalCount,r=100/o,i=GRID_TEMPLATE.clone().css({width:r+"%"});t.empty();for(var s=0;s<o;s++){var a=i.clone();t.append(a)}},e.Factory=function(){return function(){return new e}},e.$name="intervalGrid",e}();angular.module("weeklyScheduler").directive(IntervalGridDirective.$name,IntervalGridDirective.Factory()),angular.module("weeklySchedulerI18N",["tmh.dynamicLocale"]),angular.module("weeklySchedulerI18N").provider("weeklySchedulerLocaleService",["tmhDynamicLocaleProvider",function(e){var t={doys:{"de-de":4,"en-gb":4,"en-us":6,"fr-fr":4},lang:{"de-de":{addNew:"Hinzufügen"},"en-gb":{addNew:"Add"},"en-us":{addNew:"Add"},"fr-fr":{addNew:"Ajouter"}}};this.configure=function(l){l&&angular.isObject(l)&&(angular.merge(t,l),t.localeLocationPattern&&e.localeLocationPattern(t.localeLocationPattern))},this.$get=["$rootScope","$locale","tmhDynamicLocale",function(e,l,n){var o={};function r(){var e=l.id;return o[e]?moment.locale(o[e].id):(o[e]=function(e){return{id:e,locale:{week:{dow:(l.DATETIME_FORMATS.FIRSTDAYOFWEEK+1)%7,doy:t.doys[e]}}}}(e),moment.locale(o[e].id,o[e].locale)),t.lang[e]}return e.$on("$localeChangeSuccess",function(){e.$broadcast("weeklySchedulerLocaleChanged",r())}),{$locale:l,getLang:r,set:function(e){return n.set(e)}}}]}]);var MultiSliderController=function(){function e(e,t){this.$element=e,this.$scope=t,this.size=60,this.element=this.$element[0]}return e.prototype.$onInit=function(){var e=this;this.$scope.$on("zoomedIn",function(){e.setHoverElementWidth()}),this.$scope.$on("zoomedOut",function(){e.setHoverElementWidth()})},e.prototype.$postLink=function(){var e=this;this.$hoverElement=angular.element(this.$element.find("div")[0]),this.setHoverElementWidth(),this.$element.on("mousemove",function(t){var l=e.getElementOffsetX(e.$element),n=t.pageX-l-e.$hoverElement[0].clientWidth/2,o=e.valToPixel(e.pixelToVal(n));e.$hoverElement.css({left:o+"px"})})},e.prototype.addSlot=function(e,t){e<0&&(e=0),t>this.config.maxValue&&(t=this.config.maxValue);var l=this.item;l.schedules||(l.schedules=[]),l.schedules.push({start:e,end:t})},e.prototype.getElementOffsetX=function(e){return e[0].getBoundingClientRect().left},e.prototype.getSlotLeft=function(e){return e.start/this.config.maxValue*100+"%"},e.prototype.getSlotWidth=function(e){return(e.end-e.start)/this.config.maxValue*100+"%"},e.prototype.onHoverElementClick=function(e){if(!this.$element.attr("no-add")){var t=this.getElementOffsetX(this.$element),l=this.getElementOffsetX(this.$hoverElement)-t,n=this.pixelToVal(l),o=n+this.size;this.addSlot(n,o)}},e.prototype.onWeeklySlotMouseOver=function(){this.$element.addClass("slot-hover")},e.prototype.onWeeklySlotMouseLeave=function(){this.$element.removeClass("slot-hover")},e.prototype.setHoverElementWidth=function(){var e=this.valToPixel(this.size);this.$hoverElement.css({width:e+"px"})},e.prototype.valToPixel=function(e){var t=e/this.config.intervalCount/this.config.interval;return Math.floor(t*this.element.clientWidth+.5)},e.prototype.pixelToVal=function(e){var t=e/this.element.clientWidth;return Math.floor(t*this.config.intervalCount+.5)*this.config.interval},e.$name="multiSliderController",e.$controllerAs="multiSliderCtrl",e.$inject=["$element","$scope"],e}(),MultiSliderComponent=function(){function e(){this.bindings={config:"<",item:"=",index:"<",size:"<?"},this.controller=MultiSliderController.$name,this.controllerAs=MultiSliderController.$controllerAs,this.templateUrl="ng-weekly-scheduler/multislider/multislider.html"}return e.$name="multiSlider",e}();angular.module("weeklyScheduler").controller(MultiSliderController.$name,MultiSliderController).component(MultiSliderComponent.$name,new MultiSliderComponent);var ScheduleAreaContainerController=function(){function e(e,t,l,n){this.$element=e,this.$scope=t,this.scrollService=l,this.zoomService=n}return e.prototype.$postLink=function(){var e=this,t=this.$element[0];this.scrollService.hijackScroll(t,20),this.$scope.$on("clickOnACell",function(l,n){e.zoomService.zoomInACell(t,l,n)})},e.$name="scheduleAreaContainerController",e.$inject=["$element","$scope","scrollService","zoomService"],e}(),ScheduleAreaContainerComponent=function(){function e(){this.controller=ScheduleAreaContainerController.$name,this.transclude=!0,this.template="<ng-transclude></ng-transclude>"}return e.$name="scheduleAreaContainer",e}();angular.module("weeklyScheduler").controller(ScheduleAreaContainerController.$name,ScheduleAreaContainerController).component(ScheduleAreaContainerComponent.$name,new ScheduleAreaContainerComponent);var ScrollService=function(){function e(){}return e.prototype.hijackScroll=function(e,t){e.addEventListener("mousewheel",function(l){if(l.preventDefault(),l.stopPropagation(),l.ctrlKey){var n=e.querySelector(".schedule-area").style,o=parseInt(n.width,10);if((l.wheelDelta||l.detail)>0)n.width=o+2*t+"%";else{var r=o-2*t;n.width=(r>100?r:100)+"%"}}else(l.wheelDelta||l.detail)>0?e.scrollLeft-=t:e.scrollLeft+=t;return!1})},e.$name="scrollService",e}();angular.module("weeklyScheduler").service(ScrollService.$name,ScrollService);var TimeOfDayFilter=function(){function e(){}return e.Factory=function(){return function(e){var t=moment.duration(e,"minutes").format("HH:mm",{trim:!1});return moment(t,"HH:mm").format("h:mmA")}},e.$name="timeOfDay",e}();angular.module("weeklyScheduler").filter(TimeOfDayFilter.$name,[TimeOfDayFilter.Factory]);var WeeklySchedulerController=function(){function e(e,t){this.$scope=e,this.localeService=t,this.defaultOptions={monoSchedule:!1}}return e.prototype.$onInit=function(){var e=this;this.defaultOptions.labels=this.localeService.getLang(),this.$modelChangeListeners=[],this.$scope.$watchCollection(function(){return e.items},function(t){return e.onModelChange(t)}),this.$scope.$on("weeklySchedulerLocaleChanged",function(e,t){this.config&&(this.config.labels=t),this.onModelChange(angular.copy(this.items,[]))})},e.prototype.configure=function(e){var t=e.interval||15,l=1440/t;return angular.extend(this.defaultOptions,{interval:t,maxValue:1440,hourCount:24,intervalCount:l})},e.prototype.onModelChange=function(e){var t=this;if(e){if(!angular.isArray(e))throw"You should use weekly-scheduler directive with an Array of items";this.items=e,e.forEach(function(e){var l=e.schedules;l&&l.length?t.options.monoSchedule&&(e.schedules=[l[0]]):e.schedules=[]}),this.config=this.configure(this.options),this.$modelChangeListeners.forEach(function(e){e(t.config)})}},e.$controllerAs="schedulerCtrl",e.$name="weeklySchedulerController",e.$inject=["$scope","weeklySchedulerLocaleService"],e}(),WeeklySchedulerComponent=function(){function e(){this.bindings={items:"=",options:"=",onChange:"&"},this.controller=WeeklySchedulerController.$name,this.controllerAs=WeeklySchedulerController.$controllerAs,this.transclude=!0,this.templateUrl="ng-weekly-scheduler/weekly-scheduler/weekly-scheduler.html"}return e.$name="weeklyScheduler",e}();angular.module("weeklyScheduler").controller(WeeklySchedulerController.$name,WeeklySchedulerController).component(WeeklySchedulerComponent.$name,new WeeklySchedulerComponent);var WeeklySlotController=function(){function e(e,t){this.$element=e,this.$scope=t,this.resizeDirectionIsStart=!0,this.$containerEl=this.$element.parent()}return e.prototype.$onInit=function(){var e=this;this.valuesOnDragStart={start:this.schedule.start,end:this.schedule.end},this.mergeOverlaps(),this.ngModelCtrl.$parsers.push(function(t){return e.ngModelCtrl.$modelValue.start=t.start,e.ngModelCtrl.$modelValue.end=t.end,e.ngModelCtrl.$modelValue}),this.$scope.$on("weeklySchedulerLocaleChanged",function(){e.schedule=angular.copy(e.schedule)})},e.prototype.canRemove=function(){return!angular.isDefined(this.item.editable)||this.item.editable},e.prototype.deleteSelf=function(){this.$containerEl.removeClass("dragging"),this.$containerEl.removeClass("slot-hover"),this.removeSchedule(this.schedule)},e.prototype.drag=function(e){var t=this.schedule,l=this.pixelToVal(e),n=this.valuesOnDragStart.end-this.valuesOnDragStart.start,o=Math.round(this.valuesOnDragStart.start+l),r=Math.round(o+n);t.start!==o&&o>=0&&r<=this.config.maxValue&&this.updateSelf({start:o,end:r})},e.prototype.endDrag=function(){var e=this;setTimeout(function(){e.$containerEl.removeAttr("no-add")},500),this.$element.removeClass("active"),this.$containerEl.removeClass("dragging"),this.mergeOverlaps()},e.prototype.mergeOverlaps=function(){var e=this,t=this.schedule;this.item.schedules.forEach(function(l){l!==t&&(l.end>=t.end&&l.start<=t.start?(e.removeSchedule(l),e.updateSelf({start:l.start,end:l.end})):t.end>=l.end&&t.start<=l.start?e.removeSchedule(l):l.end>=t.start&&l.end<=t.end?(e.removeSchedule(l),e.updateSelf({start:l.start,end:t.end})):l.start>=t.start&&l.start<=t.end&&(e.removeSchedule(l),e.updateSelf({start:t.start,end:l.end})))})},e.prototype.pixelToVal=function(e){var t=e/this.$containerEl[0].clientWidth;return Math.floor(t*this.config.intervalCount+.5)*this.config.interval},e.prototype.removeSchedule=function(e){var t=this.item.schedules;t.splice(t.indexOf(e),1)},e.prototype.resize=function(e){var t=this.schedule,l=this.pixelToVal(e);if(this.resizeDirectionIsStart){var n=Math.round(this.valuesOnDragStart.start+l);t.start!==n&&n<=t.end-1&&n>=0&&this.updateSelf({start:n,end:t.end})}else{var o=Math.round(this.valuesOnDragStart.end+l);t.end!==o&&o>=t.start+1&&o<=this.config.maxValue&&this.updateSelf({start:t.start,end:o})}},e.prototype.startDrag=function(){this.$element.addClass("active"),this.$containerEl.addClass("dragging"),this.$containerEl.attr("no-add","true"),this.valuesOnDragStart={start:this.schedule.start,end:this.schedule.end}},e.prototype.startResizeStart=function(){this.resizeDirectionIsStart=!0,this.startDrag()},e.prototype.startResizeEnd=function(){this.resizeDirectionIsStart=!1,this.startDrag()},e.prototype.updateSelf=function(e){this.ngModelCtrl.$setViewValue(e),this.schedulerCtrl.onChange({itemIndex:this.itemIndex,scheduleIndex:this.scheduleIndex,scheduleValue:this.ngModelCtrl.$modelValue})},e.$name="weeklySlotController",e.$controllerAs="weeklySlotCtrl",e.$inject=["$element","$scope"],e}(),WeeklySlotComponent=function(){function e(){this.bindings={config:"<",schedule:"=ngModel",itemIndex:"<",scheduleIndex:"<",item:"="},this.controller=WeeklySlotController.$name,this.controllerAs=WeeklySlotController.$controllerAs,this.require={schedulerCtrl:"^weeklyScheduler",ngModelCtrl:"ngModel"},this.templateUrl="ng-weekly-scheduler/weekly-slot/weekly-slot.html"}return e.$name="weeklySlot",e}();angular.module("weeklyScheduler").controller(WeeklySlotController.$name,WeeklySlotController).component(WeeklySlotComponent.$name,new WeeklySlotComponent);var ZoomService=function(){function e(e){this.$rootScope=e,this.selector=".schedule-area"}return e.prototype.broadcastZoomedInEvent=function(){this.$rootScope.$broadcast("zoomedIn")},e.prototype.broadcastZoomedOutEvent=function(){this.$rootScope.$broadcast("zoomedOut")},e.prototype.resetZoom=function(e){e.querySelector(this.selector).style.width="100%",this.broadcastZoomedOutEvent()},e.prototype.zoomInACell=function(e,t,l){var n=l.nbElements,o=l.idx,r=l.percentWidthFromBeginning,i=e.offsetWidth,s=i/(5/3),a=s/3,c=n*s,d=c/i*100;e.querySelector(this.selector).style.width=d+"%",e.scrollLeft=void 0===r?o*s-a:c*(r/100)-a,this.broadcastZoomedInEvent()},e.$name="zoomService",e.$inject=["$rootScope"],e}();angular.module("weeklyScheduler").service(ZoomService.$name,ZoomService),angular.module("ngWeeklySchedulerTemplates",[]).run(["$templateCache",function(e){e.put("index.html",'<!doctype html><html lang="en"><head><meta charset="UTF-8"><title>Angularjs weekly scheduler demo</title><link rel="stylesheet" href="testStyles.css"></head><body class="container-fluid" ng-app="demoApp"><div class="row" ng-controller="DemoController as demo"><h1>Angularjs weekly scheduler</h1><h2 id="demo" class="page-header">1. Demo</h2><div><label for="language">Choose your language:</label><select id="language" ng-model="model.locale" ng-change="demo.onLocaleChange()"><option value="en-us" selected="selected">us</option><option value="en-gb" selected="selected">gb</option><option value="fr-fr">fr</option><option value="de-de">de</option><option value="es-es">es (lang customized in demo)</option></select></div><div><code>$scope.model</code><pre ng-bind="model | json" style="max-height: 200px; overflow-y: auto"></pre></div><weekly-scheduler class="scheduler" items="model.items" on-change="demo.doSomething(itemIndex, scheduleIndex, scheduleValue)" on-delete="demo.doSomething()" options="model.options"></weekly-scheduler><script src="testVendorScripts.js"><\/script><script src="testScripts.js"><\/script></div></body></html>'),e.put("ng-weekly-scheduler/multislider/multislider.html",'<div class="slot ghost" ng-click="multiSliderCtrl.onHoverElementClick()" ng-show="multiSliderCtrl.item.editable !== false && (!multiSliderCtrl.config.monoSchedule || !multiSliderCtrl.item.schedules.length)">{{multiSliderCtrl.config.labels.addNew || \'Add New\'}}</div><weekly-slot class="slot" config="multiSliderCtrl.config" item="multiSliderCtrl.item" item-index="multiSliderCtrl.index" ng-class="{disable: multiSliderCtrl.item.editable === false}" ng-repeat="schedule in multiSliderCtrl.item.schedules" ng-model="schedule" ng-model-options="{ updateOn: \'default blur\' }" ng-mouseleave="multiSliderCtrl.onWeeklySlotMouseLeave()" ng-mouseover="multiSliderCtrl.onWeeklySlotMouseOver()" ng-style="{\r\n                 left: multiSliderCtrl.getSlotLeft(schedule),\r\n                 width: multiSliderCtrl.getSlotWidth(schedule) \r\n             }" schedule-index="$index"></weekly-slot>'),e.put("ng-weekly-scheduler/weekly-scheduler/weekly-scheduler.html",'<div class="labels"><div class="srow timestamps"></div><div class="srow schedule-animate" ng-repeat="item in schedulerCtrl.items">{{ item.label }}</div></div><schedule-area-container><div class="schedule-area"><div class="srow timestamps"><hourly-grid class="grid-container"></hourly-grid></div><div class="srow schedule-animate" ng-repeat="item in schedulerCtrl.items"><interval-grid class="grid-container striped" no-text></interval-grid><multi-slider config="schedulerCtrl.config" item="item" index="$index"></multi-slider></div></div></schedule-area-container>'),e.put("ng-weekly-scheduler/weekly-slot/weekly-slot.html",'<div title="{{weeklySlotCtrl.schedule.start | timeOfDay}} - {{weeklySlotCtrl.schedule.end | timeOfDay}}"><div class="handle left" ondrag="weeklySlotCtrl.resize(delta)" ondragstart="weeklySlotCtrl.startResizeStart()" ondragstop="weeklySlotCtrl.endDrag()" handle></div><div class="middle" ondrag="weeklySlotCtrl.drag(delta)" ondragstart="weeklySlotCtrl.startDrag()" ondragstop="weeklySlotCtrl.endDrag()" handle>{{weeklySlotCtrl.schedule.start | timeOfDay}} - {{weeklySlotCtrl.schedule.end | timeOfDay}}</div><div class="handle right" ondrag="weeklySlotCtrl.resize(delta)" ondragstart="weeklySlotCtrl.startResizeEnd()" ondragstop="weeklySlotCtrl.endDrag()" handle></div><div class="remove" ng-click="weeklySlotCtrl.deleteSelf()" ng-if="::weeklySlotCtrl.canRemove()"><span class="glyphicon glyphicon-remove"></span></div></div>')}]);